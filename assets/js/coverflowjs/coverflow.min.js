/*! CoverflowJS - v2.3.0pre - 2013-06-01
* Copyright (c) 2008-2013 Paul Baukus, Addy Osmani, Sebastian Sauer; Licensed MIT */
(function(t){if(null==t.support.transform){if("undefined"!=typeof Modernizr&&null!=Modernizr.csstransforms)return t.support.transform=Modernizr.csstransforms,void 0;var i=t("<div />"),e=i.get(0).style,s=["Webkit","Moz","O","ms"];t.support.transform="transform"in e,t.support.transform||t.each(s,function(i,s){return s+"Transform"in e?(t.support.transform=!0,!1):!0}),i.remove()}})(jQuery),function(t){t.widget("ui.coverflow",{options:{items:"> *",stacking:.73,active:0,duration:200,easing:"easeOutQuint",trigger:{itemfocus:!0,itemclick:!0,mousewheel:!0,swipe:!0}},isTicking:!1,_create:function(){var i=this.options;this.items=this.element.find(i.items).addClass("ui-coverflow-item").prop("tabIndex",0),this.element.addClass("ui-coverflow").parent().addClass("ui-coverflow-wrapper ui-clearfix"),i.trigger.itemfocus&&this._on(this.items,{focus:this._select}),i.trigger.itemclick&&this._on(this.items,{click:this._select}),i.trigger.mousewheel&&this._on({mousewheel:this._onMouseWheel,DOMMouseScroll:this._onMouseWheel}),i.trigger.swipe&&this._on({swipeleft:this.next,swiperight:this.prev}),this.useJqueryAnimate=!t.fn.transit||!t.support.transition||!t.isFunction(window.requestAnimationFrame)},_init:function(){var i=this.options,e={};i.stacking=parseFloat(i.stacking),i.stacking=i.stacking>0&&1>i.stacking?i.stacking:.73,i.duration=~~i.duration,1>i.duration&&(i.duration=1),this.origElementDimensions={width:this.element.width(),height:this.element.height()},this.itemMargin=-Math.floor((1-i.stacking)/2*this.items.innerWidth()),this.currentIndex=this._isValidIndex(i.active,!0)?i.active:0,this.activeItem=this.items.css({marginLeft:this.itemMargin,marginRight:this.itemMargin}).removeClass("ui-state-active").eq(this.currentIndex).addClass("ui-state-active"),this.itemWidth=this.items.width(),this.itemHeight=this.items.height(),this.itemSize=this.items.outerWidth(!0),this.outerWidth=this.element.parent().outerWidth(!1),e.width=this.itemWidth*this.items.length,t.extend(e,this._getCenterPosition()),this.element.css(e),this._refresh(1,this._getFrom(),this.currentIndex),this.initialOffset=parseInt(this.activeItem.css("left"),10),this._trigger("select",null,this._ui())},_getCenterPosition:function(){var t;return t=-this.currentIndex*this.itemSize/2,t+=this.outerWidth/2-this.itemSize/2,t-=parseInt(this.element.css("paddingLeft"),10)||0,t=Math.round(t),{left:t}},_isValidIndex:function(t,i){return i=!!i,t=~~t,(this.currentIndex!==t||i)&&t>-1&&!!this.items.get(t)},_select:function(t){this.select(t.currentTarget)},next:function(){return this.select(this.currentIndex+1)},prev:function(){return this.select(this.currentIndex-1)},_getFrom:function(){return 1>=Math.abs(this.previous-this.currentIndex)?this.previousIndex:this.currentIndex+(this.previousIndex<this.currentIndex?-1:1)},select:function(i){var e,s=this.options,n=isNaN(parseInt(i,10))?this.items.index(i):parseInt(i,10);return this._isValidIndex(n)?!1===this._trigger("beforeselect",null,this._ui(this.items.eq(n),n))?!1:(this.isTicking&&(this.useJqueryAnimate?this.element.stop(!0,!1):(this.element.data("coverflowrafid")&&cancelAnimationFrame(this.element.data("coverflowrafid")),this.element.transitionStop(!0,!1))),this.isTicking=!0,this.previousIndex=this.currentIndex,this.options.active=this.currentIndex=n,e={coverflow:1},t.extend(e,this._getCenterPosition()),this.useJqueryAnimate?(this._animation(s,e),!0):(t.extend(e,{duration:s.duration,easing:s.easing}),this._transition(e),!0)):!1},_animation:function(i,e){var s=this,n=this._getFrom();t.fx.step.coverflow=function(t){s._refresh(t.now,n,s.currentIndex)},this.element.animate(e,{duration:i.duration,easing:i.easing}).promise().done(function(){s._onAnimationEnd.apply(s)})},_transition:function(t){var i=this,e=new Date,s=this._getFrom(),n=this.currentIndex,r=function(){var o=((new Date).getTime()-e.getTime())/t.duration;i.isTicking&&i.element.data("coverflowrafid",requestAnimationFrame(r)),o>1?i.isTicking=!1:i._refresh(o,s,n)};this.element.data("coverflowrafid",requestAnimationFrame(r)).transit({x:-this.currentIndex*this.itemSize/2-this.initialOffset},t.duration,this.options.easing,function(){cancelAnimationFrame(i.element.data("rafId")),i._refresh(1,s,n),setTimeout(function(){i._onAnimationEnd.apply(i)},0)})},_onAnimationEnd:function(){this.isTicking=!1,this.activeItem=this.items.removeClass("ui-state-active").eq(this.currentIndex).addClass("ui-state-active"),this._trigger("select",null,this._ui())},_refresh:function(i,e,s){var n=this;this.element.parent().scrollTop(0),this.items.each(function(r){var o,a,h=r===s&&0>e-s||r-s>0?"left":"right",u=r===s?1-i:r===e?i:1,c={zIndex:n.items.length+("left"===h?s-r:r-s)},m=1+.3*(1-u);c.left=-r*(n.itemSize/2)+("right"===h?-n.itemSize/2:n.itemSize/2)*u,o=[m,u*("right"===h?-.2:.2),0,m,0,0],t.support.transform?c.transform="matrix("+o.join(",")+")":(this.filters["DXImageTransform.Microsoft.Matrix"]||(this.style.filter=(this.style.filter?"":" ")+'progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand")'),a=this.filters["DXImageTransform.Microsoft.Matrix"],a.M11=o[0],a.M12=o[2],a.M21=o[1],a.M22=o[3]),t(this).css(c)})},_ui:function(t,i){return{active:this.activeItem,index:i||this.currentIndex}},_onMouseWheel:function(t){var i=t.originalEvent;return t.preventDefault(),i.wheelDelta>0||0>i.detail?(this.prev(),void 0):(this.next(),void 0)},_destroy:function(){this.element.css(this.origElementDimensions).removeClass("ui-coverflow").parent().removeClass("ui-coverflow-wrapper"),this.items.css({transform:"",marginLeft:0,marginRight:0}),this._super()}})}(jQuery);